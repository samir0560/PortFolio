<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #667eea;
            --primary-dark: #5a67d8;
            --secondary-color: #2d3748;
            --accent-color: #f56565;
            --success-color: #48bb78;
            --warning-color: #ed8936;
            --info-color: #4299e1;
            --light-color: #f7fafc;
            --dark-color: #1a202c;
            --text-color: #2d3748;
            --text-light: #718096;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border-radius: 8px;
            --border-radius-lg: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-color);
            line-height: 1.6;
            font-size: 14px;
            margin: 0;
            padding: 0;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            background: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: var(--shadow);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }

        .toast.success {
            border-left: 4px solid var(--success-color);
        }

        .toast.error {
            border-left: 4px solid var(--accent-color);
        }

        .toast i {
            font-size: 1.2rem;
        }

        .toast.success i {
            color: var(--success-color);
        }

        .toast.error i {
            color: var(--accent-color);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .dashboard {
            display: flex;
            min-height: 100vh;
        }

        .dashboard-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
            padding: 20px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
        }

        .header-left h2 {
            color: var(--secondary-color);
            margin: 0 0 4px 0;
            font-size: 24px;
            font-weight: 700;
        }

        .current-time {
            color: var(--text-light);
            font-size: 13px;
            font-weight: 500;
        }

        .btn {
            padding: 12px 24px;
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-family: inherit;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-sm);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--secondary-color);
        }

        .btn-danger {
            background: var(--accent-color);
        }

        .btn-success {
            background: var(--success-color);
        }

        .dashboard-sidebar {
            width: 280px;
            background: var(--gradient-primary);
            color: white;
            height: 100vh;
            position: sticky;
            top: 0;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .sidebar-header h2 {
            margin: 0;
            font-size: 20px;
            font-weight: 700;
            opacity: 0.95;
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
            margin: 0;
        }

        .sidebar-menu li {
            margin-bottom: 4px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 14px 24px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            gap: 12px;
            font-weight: 500;
            border-radius: 0 25px 25px 0;
            margin-right: 20px;
            position: relative;
        }

        .sidebar-menu a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(5px);
        }

        .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            box-shadow: var(--shadow);
        }

        .sidebar-menu a i {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        
        .dashboard-content {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.02);
        }

        .dashboard-section {
            display: none;
        }

        .dashboard-section.active {
            display: block;
        }

        .dashboard-section h3 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .dashboard-section h4 {
            color: var(--secondary-color);
            margin: 30px 0 15px;
            font-size: 1.2rem;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 28px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card i {
            font-size: 32px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
            display: block;
        }

        .stat-card h3 {
            font-size: 28px;
            margin: 8px 0;
            color: var(--secondary-color);
            font-weight: 700;
        }

        .stat-card p {
            color: var(--text-light);
            font-weight: 500;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: var(--light-color);
            color: var(--secondary-color);
            font-weight: 600;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: var(--transition);
        }

        .edit-btn {
            background: var(--primary-color);
            color: white;
        }

        .delete-btn {
            background: var(--accent-color);
            color: white;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-read {
            background: #d4edda;
            color: #155724;
        }

        .status-unread {
            background: #fff3cd;
            color: #856404;
        }

        .settings-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            margin-bottom: 25px;
        }

        .settings-section h4 {
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-family: inherit;
            transition: var(--transition);
            font-size: 14px;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        .password-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .password-container input {
            padding-right: 45px !important;
        }

        .toggle-password {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--text-light);
            font-size: 16px;
            z-index: 10;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .toggle-password:hover {
            color: var(--secondary-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 1px solid #eee;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--secondary-color);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .modal form {
            padding: 25px;
        }

        .image-upload-options {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
        }

        .upload-option {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .upload-option.active {
            color: var(--primary-color);
            font-weight: 600;
        }

        #image-preview, #about-image-preview {
            margin-top: 10px;
            max-width: 200px;
            border-radius: 5px;
            overflow: hidden;
            border: 2px dashed #ddd;
            padding: 10px;
            text-align: center;
        }

        #image-preview img, #about-image-preview img {
            width: 100%;
            height: auto;
            display: block;
        }

        .image-placeholder {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-container input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-input-label {
            display: block;
            padding: 12px 15px;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .file-input-label:hover {
            background: #e9ecef;
            border-color: var(--primary-color);
        }

        .file-input-label i {
            margin-right: 8px;
            color: var(--primary-color);
        }

        .technologies-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .technology-tag {
            background: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .technology-tag i {
            font-size: 0.9rem;
        }

        .technology-tag .remove-tag {
            cursor: pointer;
            font-weight: bold;
            margin-left: 5px;
        }

        /* Custom Notification Styles */
        .custom-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            min-width: 320px;
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            border-left: 5px solid var(--primary-color);
            transform: translateX(100%);
            opacity: 0;
            transition: var(--transition);
        }

        .custom-notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .custom-notification.success {
            border-left-color: var(--success-color);
        }

        .custom-notification.error {
            border-left-color: var(--accent-color);
        }

        .custom-notification.warning {
            border-left-color: var(--warning-color);
        }

        .custom-notification.info {
            border-left-color: var(--info-color);
        }

        .notification-content {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            gap: 12px;
        }

        .notification-content i {
            font-size: 20px;
        }

        .custom-notification.success .notification-content i {
            color: var(--success-color);
        }

        .custom-notification.error .notification-content i {
            color: var(--accent-color);
        }

        .custom-notification.warning .notification-content i {
            color: var(--warning-color);
        }

        .custom-notification.info .notification-content i {
            color: var(--info-color);
        }

        .notification-content span {
            flex: 1;
            font-weight: 500;
            color: var(--text-color);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            padding: 4px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .notification-close:hover {
            background: var(--light-color);
            color: var(--text-color);
        }

        /* Custom Confirmation Modal Styles */
        .custom-confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10001;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .custom-confirm-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .confirm-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .confirm-dialog {
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            width: 90%;
            max-width: 400px;
            position: relative;
            overflow: hidden;
        }

        .confirm-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .confirm-header i {
            font-size: 24px;
        }

        .confirm-header h3 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .confirm-body {
            padding: 24px;
        }

        .confirm-body p {
            margin: 0;
            color: var(--text-color);
            line-height: 1.6;
        }

        .confirm-actions {
            padding: 0 24px 24px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn-cancel, .btn-confirm {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-cancel {
            background: var(--light-color);
            color: var(--text-color);
        }

        .btn-cancel:hover {
            background: var(--border-color);
        }

        .btn-confirm {
            background: var(--accent-color);
            color: white;
        }

        .btn-confirm:hover {
            background: #e53e3e;
        }

        /* Icon Preview Styles */
        #icon-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            display: none;
            align-items: center;
        }

        #icon-preview.show {
            display: flex;
        }

        #icon-display {
            font-size: 2rem;
            margin-right: 15px;
            color: var(--primary-color);
        }

        #icon-name {
            font-weight: 600;
            color: var(--secondary-color);
        }

        /* Custom Message Modal Styles */
        .custom-message-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10002;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .custom-message-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .message-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .message-dialog {
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .message-header {
            background: var(--gradient-primary);
            color: white;
            padding: 20px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }

        .message-header i {
            font-size: 20px;
        }

        .message-header h3 {
            margin: 0;
            flex: 1;
            font-size: 18px;
            font-weight: 600;
        }

        .message-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .message-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .message-content {
            padding: 24px;
        }

        .message-info {
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 12px;
        }

        .info-item label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--secondary-color);
            min-width: 80px;
        }

        .info-item span {
            color: var(--text-color);
        }

        .message-body {
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .message-body label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 12px;
        }

        .message-body p {
            background: var(--light-color);
            padding: 16px;
            border-radius: var(--border-radius);
            margin: 0;
            line-height: 1.6;
            color: var(--text-color);
        }

        @media (max-width: 768px) {
            .dashboard {
                flex-direction: column;
            }
            
            .dashboard-sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            
            .sidebar-menu {
                display: flex;
                overflow-x: auto;
                padding: 10px;
            }
            
            .sidebar-menu li {
                margin-bottom: 0;
                margin-right: 10px;
            }
            
            .sidebar-menu a {
                padding: 10px 15px;
                white-space: nowrap;
            }
            
            .stats-container {
                grid-template-columns: 1fr 1fr;
            }
            
            .table-container {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Messages Container -->
    <div class="toast-container"></div>

    <!-- Admin Dashboard -->
    <div class="dashboard">
        <div class="dashboard-sidebar">
            <div class="sidebar-header">
                <h2>🎨 Admin Panel</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" data-section="dashboard-overview"><i class="fas fa-chart-pie"></i> <span>Overview</span></a></li>
                <li><a href="#" data-section="projects-management"><i class="fas fa-project-diagram"></i> <span>Projects</span></a></li>
                <li><a href="#" data-section="skills-management"><i class="fas fa-code"></i> <span>Skills</span></a></li>
                <li><a href="#" data-section="sites-management"><i class="fas fa-globe"></i> <span>Other Sites</span></a></li>
                <li><a href="#" data-section="messages-management"><i class="fas fa-envelope"></i> <span>Messages</span></a></li>
                <li><a href="#" data-section="analytics"><i class="fas fa-chart-line"></i> <span>Analytics</span></a></li>
                <li><a href="#" data-section="settings"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
            </ul>
        </div>
        
        <div class="dashboard-content">
            <!-- Dashboard Header -->
            <div class="dashboard-header">
                <div class="header-left">
                    <h2>Admin Dashboard</h2>
                    <div class="current-time" id="current-time"></div>
                </div>
                <div class="header-actions">
                    <button id="preview-btn" class="btn btn-secondary">
                        <i class="fas fa-eye"></i> Live Preview
                    </button>
                    <button id="logout-btn" class="btn btn-danger">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Dashboard Overview -->
            <div id="dashboard-overview" class="dashboard-section active">
                <h3>Dashboard Overview</h3>
                <div class="stats-container">
                    <div class="stat-card">
                        <i class="fas fa-eye"></i>
                        <h3 id="total-visitors">0</h3>
                        <p>Total Visitors</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-project-diagram"></i>
                        <h3 id="total-projects">0</h3>
                        <p>Total Projects</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-globe"></i>
                        <h3 id="total-sites">0</h3>
                        <p>Other Sites</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-envelope"></i>
                        <h3 id="total-messages">0</h3>
                        <p>New Messages</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-code"></i>
                        <h3 id="total-skills">0</h3>
                        <p>Total Skills</p>
                    </div>
                </div>
            </div>

            <!-- Projects Management -->
            <div id="projects-management" class="dashboard-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Projects Management</h3>
                    <button id="add-project-btn" class="btn">Add New Project</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Technologies</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="projects-table">
                            <!-- Projects will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Skills Management -->
            <div id="skills-management" class="dashboard-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Skills Management</h3>
                    <button id="add-skill-btn" class="btn">Add New Skill</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Icon</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="skills-table">
                            <!-- Skills will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Other Sites Management -->
            <div id="sites-management" class="dashboard-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Other Sites Management</h3>
                    <button id="add-site-btn" class="btn">Add New Site</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>URL</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="sites-table">
                            <!-- Sites will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Messages Management -->
            <div id="messages-management" class="dashboard-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Messages Management</h3>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Subject</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="messages-table">
                            <!-- Messages will be loaded here dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Analytics -->
            <div id="analytics" class="dashboard-section">
                <h3>Website Analytics</h3>
                <div class="stats-container">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <h3 id="unique-visitors">0</h3>
                        <p>Unique Visitors</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-mouse"></i>
                        <h3 id="page-views">0</h3>
                        <p>Page Views</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-clock"></i>
                        <h3 id="avg-time">0:00</h3>
                        <p>Avg. Time on Site</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-percentage"></i>
                        <h3 id="bounce-rate">0%</h3>
                        <p>Bounce Rate</p>
                    </div>
                </div>
                
                <h4>Visitor Statistics</h4>
                <canvas id="visitorChart" height="100"></canvas>
            </div>

            <!-- Settings -->
            <div id="settings" class="dashboard-section">
                <h3>Settings</h3>
                
                <div class="settings-section">
                    <h4>Profile Picture</h4>
                    <div class="form-group">
                        <label>Upload Profile Picture</label>
                        <div class="file-input-container">
                            <input type="file" id="about-image-upload" class="form-control" accept="image/*">
                            <label for="about-image-upload" class="file-input-label">
                                <i class="fas fa-upload"></i> Choose Profile Picture
                            </label>
                        </div>
                        <div id="about-image-preview">
                            <div class="image-placeholder">No image selected</div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>Admin Settings</h4>
                    <div class="form-group">
                        <label for="admin-username">Admin Username</label>
                        <input type="text" id="admin-username" class="form-control" value="admin">
                    </div>
                    <div class="form-group">
                        <label for="current-password">Current Password</label>
                        <div class="password-container">
                            <input type="password" id="current-password" class="form-control" placeholder="Enter current password">
                            <span class="toggle-password">
                                <i class="far fa-eye" id="current-toggle-password-icon"></i>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="admin-password">New Password</label>
                        <div class="password-container">
                            <input type="password" id="admin-password" class="form-control" placeholder="Enter new password">
                            <span class="toggle-password">
                                <i class="far fa-eye" id="admin-toggle-password-icon"></i>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirm New Password</label>
                        <div class="password-container">
                            <input type="password" id="confirm-password" class="form-control" placeholder="Confirm new password">
                            <span class="toggle-password">
                                <i class="far fa-eye" id="confirm-toggle-password-icon"></i>
                            </span>
                        </div>
                    </div>
                    <div class="form-group">
                        <button type="button" id="change-password-btn" class="btn btn-secondary">Change Password</button>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>Site Settings</h4>
                    <div class="form-group">
                        <label for="site-title">Site Title</label>
                        <input type="text" id="site-title" class="form-control" value="Samir Chaudhary Portfolio">
                    </div>
                    <div class="form-group">
                        <label for="site-description">Site Description</label>
                        <textarea id="site-description" class="form-control">Full Stack Developer & UI/UX Designer</textarea>
                    </div>
                    <div class="form-group">
                        <label for="about-name">About Name</label>
                        <input type="text" id="about-name" class="form-control" value="Samir Chaudhary">
                    </div>
                    <div class="form-group">
                        <label for="about-description">About Description</label>
                        <textarea id="about-description" class="form-control">I'm a passionate full-stack developer with expertise in modern web technologies...</textarea>
                    </div>
                </div>

                <div class="settings-section">
                    <h4>Contact Information</h4>
                    <div class="form-group">
                        <label for="contact-location">Location</label>
                        <input type="text" id="contact-location" class="form-control" value="Kathmandu, Nepal">
                    </div>
                    <div class="form-group">
                        <label for="contact-email">Email</label>
                        <input type="email" id="contact-email" class="form-control" value="samir@example.com">
                    </div>
                    <div class="form-group">
                        <label for="contact-phone">Phone</label>
                        <input type="text" id="contact-phone" class="form-control" value="+977 9800000000">
                    </div>
                    <div class="form-group">
                        <label for="contact-website">Website</label>
                        <input type="text" id="contact-website" class="form-control" value="www.samirportfolio.com">
                    </div>
                </div>

                <div class="settings-section">
                    <h4>Social Links</h4>
                    <div class="form-group">
                        <label for="social-github">GitHub URL</label>
                        <input type="text" id="social-github" class="form-control" value="#">
                    </div>
                    <div class="form-group">
                        <label for="social-linkedin">LinkedIn URL</label>
                        <input type="text" id="social-linkedin" class="form-control" value="#">
                    </div>
                    <div class="form-group">
                        <label for="social-twitter">Twitter URL</label>
                        <input type="text" id="social-twitter" class="form-control" value="#">
                    </div>
                    <div class="form-group">
                        <label for="social-dribbble">Dribbble URL</label>
                        <input type="text" id="social-dribbble" class="form-control" value="#">
                    </div>
                </div>

                <button id="save-settings" class="btn">Save All Settings</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Project Modal -->
    <div id="project-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="project-modal-title">Add New Project</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="project-form">
                <input type="hidden" id="project-id">
                <div class="form-group">
                    <label for="project-title">Project Title</label>
                    <input type="text" id="project-title" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="project-category">Category</label>
                    <select id="project-category" class="form-control" required>
                        <option value="web">Web App</option>
                        <option value="mobile">Mobile App</option>
                        <option value="design">UI/UX Design</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="project-description">Description</label>
                    <textarea id="project-description" class="form-control" required></textarea>
                </div>
                <div class="form-group">
                    <label>Project Image</label>
                    <div class="file-input-container">
                        <input type="file" id="project-image-upload" class="form-control" accept="image/*">
                        <label for="project-image-upload" class="file-input-label">
                            <i class="fas fa-upload"></i> Choose Project Image
                        </label>
                    </div>
                    <div id="image-preview">
                        <div class="image-placeholder">No image selected</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="project-technologies">Technologies</label>
                    <input type="text" id="project-technologies" class="form-control" placeholder="Add technology and press Enter">
                    <small style="color: #666; font-size: 0.9rem; margin-top: 5px; display: block;">Press Enter or click Add to include it.</small>
                    <div class="technologies-input" id="technologies-container">
                        <!-- Technology tags will be added here -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="project-live">Live URL</label>
                    <input type="text" id="project-live" class="form-control" placeholder="https://">
                </div>
                <div class="form-group">
                    <label for="project-github">GitHub URL</label>
                    <input type="text" id="project-github" class="form-control" placeholder="https://">
                </div>
                <button type="submit" class="btn">Save Project</button>
            </form>
        </div>
    </div>

    <!-- Add/Edit Site Modal -->
    <div id="site-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="site-modal-title">Add New Site</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="site-form">
                <input type="hidden" id="site-id">
                <div class="form-group">
                    <label for="site-name">Site Name</label>
                    <input type="text" id="site-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="site-url">Site URL</label>
                    <input type="url" id="site-url" class="form-control" placeholder="https://example.com" required>
                </div>
                <div class="form-group">
                    <label for="site-description">Description (Optional)</label>
                    <textarea id="site-description" class="form-control" placeholder="Brief description of the site"></textarea>
                </div>
                <button type="submit" class="btn">Save Site</button>
            </form>
        </div>
    </div>

    <!-- Add/Edit Skill Modal -->
    <div id="skill-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="skill-modal-title">Add New Skill</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="skill-form">
                <input type="hidden" id="skill-id">
                <div class="form-group">
                    <label for="skill-name">Skill Name</label>
                    <input type="text" id="skill-name" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="skill-icon">Icon Class (Font Awesome)</label>
                    <input type="text" id="skill-icon" class="form-control" placeholder="e.g. fab fa-js-square" required>
                    <button type="button" id="fetch-icon-btn" class="btn" style="margin-top: 10px;">Fetch Icon from API</button>
                    <div id="icon-preview" style="margin-top: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; display: none;">
                        <i id="icon-display" style="font-size: 2rem; margin-right: 10px;"></i>
                        <span id="icon-name"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="skill-description">Description (Optional)</label>
                    <textarea id="skill-description" class="form-control" placeholder="Brief description of the skill"></textarea>
                </div>
                <button type="submit" class="btn">Save Skill</button>
            </form>
        </div>
    </div>

    <script>
        // Data Management
        let adminData = JSON.parse(localStorage.getItem('adminData')) || {
            username: 'admin',
            password: 'lovesubaby',
            settings: {
                siteTitle: 'Samir Chaudhary Portfolio',
                siteDescription: 'Full Stack Developer & UI/UX Designer',
                aboutName: 'Samir Chaudhary',
                aboutDescription: 'I\'m a passionate full-stack developer with expertise in modern web technologies...',
                contactLocation: 'Kathmandu, Nepal',
                contactEmail: 'samir@example.com',
                contactPhone: '+977 9800000000',
                contactWebsite: 'www.samirportfolio.com',
                socialGithub: '#',
                socialLinkedin: '#',
                socialTwitter: '#',
                socialDribbble: '#',
                aboutImage: ''
            },
            projects: [],
            skills: [],
            sites: [],
            messages: [],
            analytics: {
                totalVisitors: 0, // Starting from zero
                totalProjects: 0,
                totalSites: 0,
                totalMessages: 0,
                totalSkills: 0,
                uniqueVisitors: 0,
                pageViews: 0,
                avgTime: '0:00',
                bounceRate: '0%'
            }
        };

        // DOM Elements
        const currentTimeEl = document.getElementById('current-time');
        const logoutBtn = document.getElementById('logout-btn');
        const sidebarLinks = document.querySelectorAll('.sidebar-menu a');
        const dashboardSections = document.querySelectorAll('.dashboard-section');
        
        // Modals
        const projectModal = document.getElementById('project-modal');
        const siteModal = document.getElementById('site-modal');
        const skillModal = document.getElementById('skill-modal');
        const closeModalButtons = document.querySelectorAll('.close-modal');
        
        // Buttons
        const addProjectBtn = document.getElementById('add-project-btn');
        const addSiteBtn = document.getElementById('add-site-btn');
        const addSkillBtn = document.getElementById('add-skill-btn');
        const changePasswordBtn = document.getElementById('change-password-btn');
        const saveSettingsBtn = document.getElementById('save-settings');
        const fetchIconBtn = document.getElementById('fetch-icon-btn');
        
        // Forms
        const projectForm = document.getElementById('project-form');
        const siteForm = document.getElementById('site-form');
        const skillForm = document.getElementById('skill-form');
        
        // File inputs
        const projectImageUpload = document.getElementById('project-image-upload');
        const aboutImageUpload = document.getElementById('about-image-upload');
        
        // Password Toggles
        const currentTogglePasswordIcon = document.getElementById('current-toggle-password-icon');
        const adminTogglePasswordIcon = document.getElementById('admin-toggle-password-icon');
        const confirmTogglePasswordIcon = document.getElementById('confirm-toggle-password-icon');
        
        // Technology tags
        const technologiesInput = document.getElementById('project-technologies');
        const technologiesContainer = document.getElementById('technologies-container');
        let technologies = [];

        // Icon fetching function
        async function fetchIconFromAPI() {
            const skillName = document.getElementById('skill-name').value.trim();
            if (!skillName) {
                showToast('Please enter a skill name first!', 'error');
                return;
            }
            
            try {
                showToast('Fetching icon...', 'info');
                
                // Simple icon mapping for common technologies
                const iconMap = {
                    'javascript': 'fab fa-js-square',
                    'js': 'fab fa-js-square',
                    'typescript': 'fab fa-js-square',
                    'ts': 'fab fa-js-square',
                    'react': 'fab fa-react',
                    'reactjs': 'fab fa-react',
                    'vue': 'fab fa-vuejs-alt',
                    'vuejs': 'fab fa-vuejs-alt',
                    'angular': 'fab fa-angular',
                    'node': 'fab fa-node-js',
                    'nodejs': 'fab fa-node-js',
                    'python': 'fab fa-python',
                    'java': 'fab fa-java',
                    'php': 'fab fa-php',
                    'html': 'fab fa-html5',
                    'html5': 'fab fa-html5',
                    'css': 'fab fa-css3-alt',
                    'css3': 'fab fa-css3-alt',
                    'sass': 'fab fa-sass',
                    'bootstrap': 'fab fa-bootstrap',
                    'git': 'fab fa-git-alt',
                    'github': 'fab fa-github',
                    'docker': 'fab fa-docker',
                    'aws': 'fab fa-aws',
                    'figma': 'fab fa-figma',
                    'npm': 'fab fa-npm',
                    'yarn': 'fab fa-yarn',
                    'database': 'fas fa-database',
                    'mongodb': 'fas fa-database',
                    'mysql': 'fas fa-database',
                    'postgresql': 'fas fa-database',
                    'firebase': 'fas fa-fire'
                };
                
                const skillLower = skillName.toLowerCase();
                let iconClass = iconMap[skillLower] || 'fas fa-code';
                
                // Try to find partial matches
                if (iconClass === 'fas fa-code') {
                    for (const [key, value] of Object.entries(iconMap)) {
                        if (skillLower.includes(key) || key.includes(skillLower)) {
                            iconClass = value;
                            break;
                        }
                    }
                }
                
                document.getElementById('skill-icon').value = iconClass;
                
                // Show preview
                const preview = document.getElementById('icon-preview');
                const iconDisplay = document.getElementById('icon-display');
                const iconName = document.getElementById('icon-name');
                
                iconDisplay.className = iconClass;
                iconName.textContent = skillName;
                preview.style.display = 'flex';
                
                showToast('Icon set successfully!', 'success');
                
            } catch (error) {
                console.error('Error setting icon:', error);
                document.getElementById('skill-icon').value = 'fas fa-code';
                showToast('Using default icon', 'warning');
            }
        }

        // Custom Notification and Confirmation System
        function showCustomNotification(message, type = 'info', duration = 4000) {
            const notification = document.createElement('div');
            notification.className = `custom-notification ${type}`;
            
            const iconMap = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="${iconMap[type] || iconMap.info}"></i>
                    <span>${message}</span>
                    <button class="notification-close" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Show notification with animation
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Auto-hide notification
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, duration);
        }
        
        function showCustomConfirm(message, onConfirm, onCancel = null) {
            const modal = document.createElement('div');
            modal.className = 'custom-confirm-modal';
            
            modal.innerHTML = `
                <div class="confirm-backdrop"></div>
                <div class="confirm-dialog">
                    <div class="confirm-header">
                        <i class="fas fa-question-circle"></i>
                        <h3>Confirm Action</h3>
                    </div>
                    <div class="confirm-body">
                        <p>${message}</p>
                    </div>
                    <div class="confirm-actions">
                        <button class="btn-cancel"><i class="fas fa-times"></i> Cancel</button>
                        <button class="btn-confirm"><i class="fas fa-check"></i> Confirm</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Show modal with animation
            setTimeout(() => modal.classList.add('show'), 100);
            
            // Event listeners
            const btnCancel = modal.querySelector('.btn-cancel');
            const btnConfirm = modal.querySelector('.btn-confirm');
            const backdrop = modal.querySelector('.confirm-backdrop');
            
            function closeModal() {
                modal.classList.remove('show');
                setTimeout(() => {
                    if (modal.parentNode) {
                        modal.parentNode.removeChild(modal);
                    }
                }, 300);
            }
            
            btnCancel.addEventListener('click', () => {
                if (onCancel) onCancel();
                closeModal();
            });
            
            backdrop.addEventListener('click', () => {
                if (onCancel) onCancel();
                closeModal();
            });
            
            btnConfirm.addEventListener('click', () => {
                onConfirm();
                closeModal();
            });
        }
        
        // Toast Function
        function showToast(message, type = 'success') {
            const toastContainer = document.querySelector('.toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // Update Time
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { 
                hour12: true, 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            currentTimeEl.textContent = timeString;
        }
        
        setInterval(updateTime, 1000);
        updateTime();

        // Navigation - Fixed implementation
        sidebarLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                
                // Remove active class from all links
                sidebarLinks.forEach(l => l.classList.remove('active'));
                
                // Add active class to clicked link
                link.classList.add('active');
                
                // Hide all sections
                dashboardSections.forEach(section => section.classList.remove('active'));
                
                // Show selected section
                const sectionId = link.getAttribute('data-section');
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            });
        });

        // Check authentication on page load
        function checkAuthentication() {
            const sessionId = localStorage.getItem('adminToken');
            if (!sessionId) {
                window.location.href = '/admin-login.html';
                return false;
            }
            
            // For demo purposes, we'll assume authentication is valid
            // In a real app, you would verify with the server
            return true;
        }

        // Logout function - Fixed implementation
        function logout() {
            showCustomConfirm('Are you sure you want to logout?', () => {
                // Clear local storage
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminData');
                
                showToast('Logged out successfully!');
                
                // Redirect after a brief delay
                setTimeout(() => {
                    window.location.href = '/admin-login.html';
                }, 1000);
            });
        }

        // Live Preview functionality
        const previewBtn = document.getElementById('preview-btn');
        let previewWindow = null;
        
        previewBtn.addEventListener('click', () => {
            if (previewWindow && !previewWindow.closed) {
                previewWindow.focus();
            } else {
                previewWindow = window.open('/', 'preview', 'width=1200,height=800,scrollbars=yes,resizable=yes');
            }
        });
        
        // Logout button event listener - Fixed implementation
        logoutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            logout();
        });

        // Initialize dashboard
        function initDashboard() {
            if (!checkAuthentication()) {
                return;
            }

            // Load user data
            const adminData = JSON.parse(localStorage.getItem('adminData'));
            if (adminData) {
                document.getElementById('admin-username').value = adminData.username || 'admin';
            }

            // Load tables
            loadProjectsTable();
            loadSkillsTable();
            loadSitesTable();
            loadMessagesTable();
            
            // Initialize chart
            initializeChart();
            
            // Update dashboard stats
            updateDashboardStats();
        }
        
        // Update dashboard statistics
        function updateDashboardStats() {
            // Update stats from adminData
            document.getElementById('total-visitors').textContent = adminData.analytics.totalVisitors;
            document.getElementById('total-projects').textContent = adminData.projects.length;
            document.getElementById('total-sites').textContent = adminData.sites.length;
            document.getElementById('total-messages').textContent = adminData.messages.length;
            document.getElementById('total-skills').textContent = adminData.skills.length;
            
            // Update analytics section
            document.getElementById('unique-visitors').textContent = adminData.analytics.uniqueVisitors;
            document.getElementById('page-views').textContent = adminData.analytics.pageViews;
            document.getElementById('avg-time').textContent = adminData.analytics.avgTime;
            document.getElementById('bounce-rate').textContent = adminData.analytics.bounceRate;
        }
        
        // Real-time update broadcast for technologies
        function broadcastTechnologyUpdate() {
            // Send message to homepage to refresh data
            if (window.opener && !window.opener.closed) {
                window.opener.postMessage({ type: 'technologyUpdate', technologies: technologies }, '*');
            }
            
            // Also broadcast to any open windows via localStorage
            localStorage.setItem('technologyUpdate', JSON.stringify({ 
                technologies: technologies, 
                timestamp: Date.now() 
            }));
        }
        
        // Real-time update broadcast
        function broadcastUpdate(type) {
            // Send message to homepage to refresh data
            if (window.opener && !window.opener.closed) {
                window.opener.postMessage({ type: 'dataUpdate', dataType: type }, '*');
            }
            
            // Also broadcast to any open windows
            localStorage.setItem('dataUpdate', JSON.stringify({ type, timestamp: Date.now() }));
        }
        
        // Enhanced API call function
        async function apiCall(endpoint, options = {}) {
            const sessionId = localStorage.getItem('adminToken');
            
            const config = {
                headers: {
                    'Content-Type': 'application/json',
                    ...(sessionId && { 'Authorization': sessionId })
                },
                ...options
            };
            
            try {
                const response = await fetch(`/api${endpoint}`, config);
                
                if (response.status === 401) {
                    // Unauthorized - redirect to login
                    localStorage.removeItem('adminToken');
                    window.location.href = 'admin-login.html';
                    return null;
                }
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('API call failed:', error);
                showToast(`Error: ${error.message}`, 'error');
                throw error;
            }
        }

        // Load dashboard statistics from server
        async function loadDashboardStats() {
            try {
                const statsData = await apiCall('/dashboard/stats');
                if (statsData && statsData.success) {
                    const stats = statsData.data;
                    
                    // Update dashboard overview cards
                    document.getElementById('total-visitors').textContent = stats.totalVisitors || 0;
                    document.getElementById('total-projects').textContent = stats.totalProjects || 0;
                    document.getElementById('total-sites').textContent = stats.totalSites || 0;
                    document.getElementById('total-messages').textContent = stats.unreadMessages || 0;
                    document.getElementById('total-skills').textContent = stats.totalSkills || 0;
                    
                    // Update analytics section if elements exist
                    const uniqueVisitorsEl = document.getElementById('unique-visitors');
                    const pageViewsEl = document.getElementById('page-views');
                    
                    if (uniqueVisitorsEl) {
                        uniqueVisitorsEl.textContent = stats.uniqueVisitors || 0;
                    }
                    if (pageViewsEl) {
                        pageViewsEl.textContent = stats.totalVisitors || 0;
                    }
                    
                    // Update local storage with latest stats
                    adminData.analytics.totalVisitors = stats.totalVisitors || 0;
                    adminData.analytics.uniqueVisitors = stats.uniqueVisitors || 0;
                    adminData.analytics.totalProjects = stats.totalProjects || 0;
                    adminData.analytics.totalSites = stats.totalSites || 0;
                    adminData.analytics.totalMessages = stats.unreadMessages || 0;
                    adminData.analytics.totalSkills = stats.totalSkills || 0;
                    localStorage.setItem('adminData', JSON.stringify(adminData));
                }
            } catch (error) {
                console.error('Failed to load dashboard stats:', error);
                // Fall back to localStorage data
                loadLocalDashboardStats();
            }
        }
        
        // Auto-refresh dashboard stats every 30 seconds
        function startStatsAutoRefresh() {
            // Initial load
            loadDashboardStats();
            
            // Refresh every 30 seconds
            setInterval(() => {
                loadDashboardStats();
                console.log('📊 Dashboard stats refreshed');
            }, 30000); // 30 seconds
        }
        
        // Load projects from server
        async function loadProjectsFromServer() {
            try {
                const response = await apiCall('/projects');
                if (response && response.success) {
                    adminData.projects = response.data || [];
                    localStorage.setItem('adminData', JSON.stringify(adminData));
                }
            } catch (error) {
                console.error('Failed to load projects from server:', error);
            }
        }
        
        // Load skills from server
        async function loadSkillsFromServer() {
            try {
                const response = await apiCall('/skills');
                if (response && response.success) {
                    adminData.skills = response.data || [];
                    localStorage.setItem('adminData', JSON.stringify(adminData));
                }
            } catch (error) {
                console.error('Failed to load skills from server:', error);
            }
        }
        
        // Load messages from server
        async function loadMessagesFromServer() {
            try {
                const response = await apiCall('/messages');
                if (response && response.success) {
                    adminData.messages = response.data || [];
                    localStorage.setItem('adminData', JSON.stringify(adminData));
                }
            } catch (error) {
                console.error('Failed to load messages from server:', error);
            }
        }
        
        // Load settings from server
        async function loadSettingsFromServer() {
            try {
                const response = await apiCall('/settings');
                if (response && response.success) {
                    const settings = response.data;
                    
                    // Update adminData with server settings
                    adminData.settings = {
                        ...adminData.settings,
                        ...settings,
                        socialGithub: settings.socialLinks?.github || '',
                        socialLinkedin: settings.socialLinks?.linkedin || '',
                        socialTwitter: settings.socialLinks?.twitter || '',
                        socialDribbble: settings.socialLinks?.dribbble || ''
                    };
                    
                    localStorage.setItem('adminData', JSON.stringify(adminData));
                }
            } catch (error) {
                console.error('Failed to load settings from server:', error);
            }
        }
        
        // Load sites from server
        async function loadSitesFromServer() {
            try {
                const response = await apiCall('/sites');
                if (response && response.success) {
                    adminData.sites = response.data || [];
                    localStorage.setItem('adminData', JSON.stringify(adminData));
                }
            } catch (error) {
                console.error('Failed to load sites from server:', error);
            }
        }
        
        // Fallback function to load from localStorage
        function loadLocalDashboardStats() {
            document.getElementById('total-visitors').textContent = adminData.analytics.totalVisitors;
            document.getElementById('total-projects').textContent = adminData.projects.length;
            document.getElementById('total-sites').textContent = adminData.sites.length;
            document.getElementById('total-messages').textContent = adminData.messages.length;
            document.getElementById('total-skills').textContent = adminData.skills.length;
            document.getElementById('unique-visitors').textContent = adminData.analytics.uniqueVisitors;
            document.getElementById('page-views').textContent = adminData.analytics.pageViews;
            document.getElementById('avg-time').textContent = adminData.analytics.avgTime;
            document.getElementById('bounce-rate').textContent = adminData.analytics.bounceRate;
        }
        
        function openModal(modal) {
            modal.classList.add('active');
        }

        function closeModal(modal) {
            modal.classList.remove('active');
        }

        closeModalButtons.forEach(button => {
            button.addEventListener('click', () => {
                const modal = button.closest('.modal');
                closeModal(modal);
            });
        });

        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeModal(e.target);
            }
        });

        // Password Toggle Functionality
        function togglePasswordVisibility(inputId, icon) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        currentTogglePasswordIcon.addEventListener('click', () => {
            togglePasswordVisibility('current-password', currentTogglePasswordIcon);
        });

        adminTogglePasswordIcon.addEventListener('click', () => {
            togglePasswordVisibility('admin-password', adminTogglePasswordIcon);
        });

        confirmTogglePasswordIcon.addEventListener('click', () => {
            togglePasswordVisibility('confirm-password', confirmTogglePasswordIcon);
        });

        // File Upload Preview
        function handleImagePreview(input, previewId) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById(previewId);
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        }

        projectImageUpload.addEventListener('change', function() {
            handleImagePreview(this, 'image-preview');
        });

        aboutImageUpload.addEventListener('change', function() {
            handleImagePreview(this, 'about-image-preview');
        });

        // Technology Tags Management - Accept any text input
        technologiesInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const tech = this.value.trim();
                
                // Accept any non-empty text and store as simple string
                if (tech) {
                    // Check for duplicates (case-insensitive)
                    const duplicate = technologies.find(t => 
                        t.toLowerCase() === tech.toLowerCase()
                    );
                    
                    if (!duplicate) {
                        technologies.push(tech); // Store as simple string
                        renderTechnologies();
                        this.value = '';
                        showToast(`Added: ${tech}`, 'success');
                    } else {
                        showToast('Already added!', 'warning');
                        this.value = '';
                    }
                } else {
                    showToast('Please enter some text!', 'error');
                }
            }
        });

        function renderTechnologies() {
            technologiesContainer.innerHTML = '';
            technologies.forEach((tech, index) => {
                const tag = document.createElement('div');
                tag.className = 'technology-tag';
                tag.innerHTML = `
                    ${tech}
                    <span class="remove-tag" data-index="${index}">&times;</span>
                `;
                technologiesContainer.appendChild(tag);
            });

            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-tag').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const removedTech = technologies[index];
                    technologies.splice(index, 1);
                    renderTechnologies();
                    showToast(`Removed: ${removedTech}`, 'info');
                });
            });
        }

        // Change Password
        changePasswordBtn.addEventListener('click', async () => {
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('admin-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            // Validation
            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('Please fill in all password fields!', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('New passwords do not match!', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showToast('Password must be at least 6 characters long!', 'error');
                return;
            }
            
            try {
                // Call API to change password
                const response = await apiCall('/admin/change-password', {
                    method: 'PUT',
                    body: JSON.stringify({
                        currentPassword: currentPassword,
                        newPassword: newPassword
                    })
                });
                
                if (response && response.success) {
                    showToast('Password changed successfully!', 'success');
                    
                    // Clear password fields
                    document.getElementById('current-password').value = '';
                    document.getElementById('admin-password').value = '';
                    document.getElementById('confirm-password').value = '';
                } else {
                    showToast(response?.error || 'Failed to change password', 'error');
                }
            } catch (error) {
                console.error('Error changing password:', error);
                showToast('Error changing password: ' + error.message, 'error');
            }
        });

        // Save Settings - Refresh page after saving
        saveSettingsBtn.addEventListener('click', async () => {
            try {
                // Create FormData for file upload
                const formData = new FormData();
                
                // Add settings data
                formData.append('siteTitle', document.getElementById('site-title').value);
                formData.append('siteDescription', document.getElementById('site-description').value);
                formData.append('aboutName', document.getElementById('about-name').value);
                formData.append('aboutDescription', document.getElementById('about-description').value);
                formData.append('contactLocation', document.getElementById('contact-location').value);
                formData.append('contactEmail', document.getElementById('contact-email').value);
                formData.append('contactPhone', document.getElementById('contact-phone').value);
                formData.append('contactWebsite', document.getElementById('contact-website').value);
                
                // Add social links
                const socialLinks = {
                    github: document.getElementById('social-github').value,
                    linkedin: document.getElementById('social-linkedin').value,
                    twitter: document.getElementById('social-twitter').value,
                    dribbble: document.getElementById('social-dribbble').value
                };
                formData.append('socialLinks', JSON.stringify(socialLinks));
                
                // Add profile image if selected
                const aboutImageFile = aboutImageUpload.files[0];
                if (aboutImageFile) {
                    formData.append('aboutImage', aboutImageFile);
                }
                
                const sessionId = localStorage.getItem('adminToken');
                
                const response = await fetch('/api/settings', {
                    method: 'PUT',
                    headers: {
                        'Authorization': sessionId
                    },
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Failed to save settings');
                }
                
                // Update local admin data
                adminData.settings = {
                    ...adminData.settings,
                    ...data.data
                };
                adminData.username = document.getElementById('admin-username').value;
                localStorage.setItem('adminData', JSON.stringify(adminData));
                
                showToast('Settings saved successfully! Page will refresh in 2 seconds.');
                
                // Trigger real-time update
                broadcastUpdate('settings');
                
                // Refresh page after 2 seconds
                setTimeout(() => {
                    window.location.reload();
                }, 2000);
                
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('Error saving settings: ' + error.message, 'error');
            }
        });

        // Initialize Dashboard
        async function initializeDashboard() {
            // Load settings into form
            document.getElementById('admin-username').value = adminData.username;
            document.getElementById('site-title').value = adminData.settings.siteTitle;
            document.getElementById('site-description').value = adminData.settings.siteDescription;
            document.getElementById('about-name').value = adminData.settings.aboutName;
            document.getElementById('about-description').value = adminData.settings.aboutDescription;
            document.getElementById('contact-location').value = adminData.settings.contactLocation;
            document.getElementById('contact-email').value = adminData.settings.contactEmail;
            document.getElementById('contact-phone').value = adminData.settings.contactPhone;
            document.getElementById('contact-website').value = adminData.settings.contactWebsite;
            document.getElementById('social-github').value = adminData.settings.socialGithub;
            document.getElementById('social-linkedin').value = adminData.settings.socialLinkedin;
            document.getElementById('social-twitter').value = adminData.settings.socialTwitter;
            document.getElementById('social-dribbble').value = adminData.settings.socialDribbble;
            
            // Load about image preview if exists
            if (adminData.settings.aboutImage) {
                document.getElementById('about-image-preview').innerHTML = `<img src="${adminData.settings.aboutImage}" alt="Profile Preview">`;
            }
            
            // Load data from server, fallback to local data
            try {
                await Promise.all([
                    loadProjectsFromServer(),
                    loadSkillsFromServer(),
                    loadSitesFromServer(),
                    loadSettingsFromServer(),
                    loadMessagesFromServer()
                ]);
            } catch (error) {
                console.error('Error loading server data:', error);
                showToast('Error loading server data: ' + error.message, 'error');
            }
            
            // Start auto-refresh for dashboard stats (loads initially and refreshes every 30s)
            startStatsAutoRefresh();
            
            // Load tables
            loadProjectsTable();
            loadSkillsTable();
            loadSitesTable();
            loadMessagesTable();
            
            // Initialize chart
            initializeChart();
            
            // Update dashboard stats
            updateDashboardStats();
        }

        // Helper function to attach event listeners with duplicate prevention
        function attachEventListener(element, event, handler, identifier) {
            // Remove existing listener if it exists
            if (element[`__${identifier}`]) {
                element.removeEventListener(event, element[`__${identifier}`]);
            }
            
            // Attach new listener and store reference
            element.addEventListener(event, handler);
            element[`__${identifier}`] = handler;
        }

        // Load Projects Table
        function loadProjectsTable() {
            const tableBody = document.getElementById('projects-table');
            tableBody.innerHTML = '';
            
            adminData.projects.forEach((project, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${project.title}</td>
                    <td>${project.category}</td>
                    <td>${project.technologies ? project.technologies.join(', ') : ''}</td>
                    <td>${project.datePosted || project.date || 'Not specified'}</td>
                    <td class="action-buttons">
                        <button class="action-btn edit-btn" data-index="${index}">Edit</button>
                        <button class="action-btn delete-btn" data-index="${index}">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners for edit and delete buttons with duplicate prevention
            document.querySelectorAll('#projects-table .edit-btn').forEach(btn => {
                const index = btn.getAttribute('data-index');
                attachEventListener(btn, 'click', () => editProject(index), `project-edit-${index}`);
            });
            
            document.querySelectorAll('#projects-table .delete-btn').forEach(btn => {
                const index = btn.getAttribute('data-index');
                attachEventListener(btn, 'click', () => deleteProject(index), `project-delete-${index}`);
            });
        }

        // Load Skills Table
        function loadSkillsTable() {
            const tableBody = document.getElementById('skills-table');
            tableBody.innerHTML = '';
            
            adminData.skills.forEach((skill, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${skill.name}</td>
                    <td><i class="${skill.icon}"></i> ${skill.icon}</td>
                    <td>${skill.description || ''}</td>
                    <td class="action-buttons">
                        <button class="action-btn edit-btn" data-index="${index}">Edit</button>
                        <button class="action-btn delete-btn" data-index="${index}">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners for edit and delete buttons with duplicate prevention
            document.querySelectorAll('#skills-table .edit-btn').forEach(btn => {
                const index = btn.getAttribute('data-index');
                attachEventListener(btn, 'click', () => editSkill(index), `skill-edit-${index}`);
            });
            
            document.querySelectorAll('#skills-table .delete-btn').forEach(btn => {
                const index = btn.getAttribute('data-index');
                attachEventListener(btn, 'click', () => deleteSkill(index), `skill-delete-${index}`);
            });
        }

        // Load Sites Table
        function loadSitesTable() {
            const tableBody = document.getElementById('sites-table');
            tableBody.innerHTML = '';
            
            adminData.sites.forEach((site, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${site.name}</td>
                    <td>${site.url}</td>
                    <td class="action-buttons">
                        <button class="action-btn edit-btn" data-index="${index}">Edit</button>
                        <button class="action-btn delete-btn" data-index="${index}">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners for edit and delete buttons with duplicate prevention
            document.querySelectorAll('#sites-table .edit-btn').forEach(btn => {
                const index = btn.getAttribute('data-index');
                attachEventListener(btn, 'click', () => editSite(index), `site-edit-${index}`);
            });
            
            document.querySelectorAll('#sites-table .delete-btn').forEach(btn => {
                const index = btn.getAttribute('data-index');
                attachEventListener(btn, 'click', () => deleteSite(index), `site-delete-${index}`);
            });
        }

        // Load Messages Table
        async function loadMessagesTable() {
            const tableBody = document.getElementById('messages-table');
            tableBody.innerHTML = '';
            
            // Load fresh messages from server
            await loadMessagesFromServer();
            
            if (adminData.messages && adminData.messages.length > 0) {
                adminData.messages.forEach((message, index) => {
                    const row = document.createElement('tr');
                    const messageDate = new Date(message.createdAt || message.date).toLocaleDateString();
                    row.innerHTML = `
                        <td>${message.name}</td>
                        <td>${message.email}</td>
                        <td>${message.subject}</td>
                        <td>${messageDate}</td>
                        <td><span class="status-badge ${message.status === 'read' ? 'status-read' : 'status-unread'}">${message.status || 'unread'}</span></td>
                        <td class="action-buttons">
                            <button class="action-btn edit-btn" data-index="${index}" onclick="viewMessage(${index})">View</button>
                            <button class="action-btn delete-btn" data-index="${index}" onclick="deleteMessage('${message._id}')">Delete</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } else {
                tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #718096; padding: 40px;">No messages received yet</td></tr>';
            }
        }
        
        // View message function - Update status to "read"
        function viewMessage(index) {
            const message = adminData.messages[index];
            
            // Update message status to "read"
            message.status = 'read';
            localStorage.setItem('adminData', JSON.stringify(adminData));
            
            // Create a beautiful message modal
            const messageModal = document.createElement('div');
            messageModal.className = 'custom-message-modal';
            
            messageModal.innerHTML = `
                <div class="message-backdrop"></div>
                <div class="message-dialog">
                    <div class="message-header">
                        <i class="fas fa-envelope"></i>
                        <h3>Message Details</h3>
                        <button class="message-close"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="message-content">
                        <div class="message-info">
                            <div class="info-item">
                                <label><i class="fas fa-user"></i> From:</label>
                                <span>${message.name}</span>
                            </div>
                            <div class="info-item">
                                <label><i class="fas fa-envelope"></i> Email:</label>
                                <span>${message.email}</span>
                            </div>
                            <div class="info-item">
                                <label><i class="fas fa-tag"></i> Subject:</label>
                                <span>${message.subject}</span>
                            </div>
                            <div class="info-item">
                                <label><i class="fas fa-calendar"></i> Date:</label>
                                <span>${new Date(message.createdAt || message.date).toLocaleDateString()}</span>
                            </div>
                        </div>
                        <div class="message-body">
                            <label><i class="fas fa-comment"></i> Message:</label>
                            <p>${message.message}</p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(messageModal);
            setTimeout(() => messageModal.classList.add('show'), 100);
            
            // Close modal events
            function closeMessageModal() {
                messageModal.classList.remove('show');
                setTimeout(() => {
                    if (messageModal.parentNode) {
                        messageModal.parentNode.removeChild(messageModal);
                    }
                    // Reload messages table to reflect status change
                    loadMessagesTable();
                    updateDashboardStats();
                }, 300);
            }
            
            messageModal.querySelector('.message-close').addEventListener('click', closeMessageModal);
            messageModal.querySelector('.message-backdrop').addEventListener('click', closeMessageModal);
        }
        
        // Delete message function
        async function deleteMessage(messageId) {
            showCustomConfirm('Are you sure you want to delete this message?', async () => {
                try {
                    await apiCall(`/messages/${messageId}`, { method: 'DELETE' });
                    await loadMessagesFromServer();
                    loadMessagesTable();
                    updateDashboardStats();
                    showCustomNotification('Message deleted successfully!', 'success');
                } catch (error) {
                    console.error('Error deleting message:', error);
                    showCustomNotification('Error deleting message: ' + error.message, 'error');
                }
            });
        }

        // Initialize Chart
        function initializeChart() {
            const ctx = document.getElementById('visitorChart').getContext('2d');
            const visitorChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Monthly Visitors',
                        data: [120, 190, 300, 500, 200, 300],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Add Project
        addProjectBtn.addEventListener('click', () => {
            document.getElementById('project-modal-title').textContent = 'Add New Project';
            projectForm.reset();
            document.getElementById('project-id').value = '';
            technologies = [];
            renderTechnologies();
            document.getElementById('image-preview').innerHTML = '<div class="image-placeholder">No image selected</div>';
            openModal(projectModal);
        });

        // Project form submission
        projectForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const projectId = document.getElementById('project-id').value;
            const projectImageFile = projectImageUpload.files[0];
            const projectTitle = document.getElementById('project-title').value.trim();
            
            if (!projectTitle) {
                showToast('Please enter a project title!', 'error');
                return;
            }
            
            if (!projectImageFile && !projectId) {
                showToast('Please select a project image!', 'error');
                return;
            }
            
            // Auto-add technology from input field if user forgot to press Enter
            const techInputValue = technologiesInput.value.trim();
            if (techInputValue) {
                // Check for duplicates (case-insensitive)
                const duplicate = technologies.find(t => 
                    t.toLowerCase() === techInputValue.toLowerCase()
                );
                
                if (!duplicate) {
                    technologies.push(techInputValue);
                    renderTechnologies();
                    technologiesInput.value = '';
                    showToast(`Auto-added: ${techInputValue}`, 'success');
                }
            }
            
            if (technologies.length === 0) {
                showToast('Please add at least one technology!', 'error');
                return;
            }
            
            try {
                // Create FormData for file upload
                const formData = new FormData();
                
                // Add text fields
                formData.append('title', projectTitle);
                formData.append('category', document.getElementById('project-category').value);
                formData.append('description', document.getElementById('project-description').value);
                formData.append('technologies', JSON.stringify(technologies));
                formData.append('liveUrl', document.getElementById('project-live').value);
                formData.append('githubUrl', document.getElementById('project-github').value);
                formData.append('datePosted', new Date().toISOString().split('T')[0]); // Add current date
                
                // Add image file if selected
                if (projectImageFile) {
                    formData.append('image', projectImageFile);
                }
                
                const sessionId = localStorage.getItem('adminToken');
                
                let response;
                if (projectId) {
                    // Update existing project
                    const endpoint = `/api/projects/${projectId}`;
                    
                    const apiResponse = await fetch(endpoint, {
                        method: 'PUT',
                        headers: {
                            'Authorization': sessionId
                        },
                        body: formData
                    });
                    
                    response = await apiResponse.json();
                } else {
                    // Add new project
                    const apiResponse = await fetch('/api/projects', {
                        method: 'POST',
                        headers: {
                            'Authorization': sessionId
                        },
                        body: formData
                    });
                    
                    response = await apiResponse.json();
                }
                
                if (!response.success) {
                    throw new Error(response.error || 'API request failed');
                }
                
                // Update local data
                if (projectId) {
                    // Update existing project - find by _id
                    const projectIndex = adminData.projects.findIndex(p => p._id === projectId);
                    if (projectIndex !== -1) {
                        adminData.projects[projectIndex] = {
                            ...adminData.projects[projectIndex],
                            title: projectTitle,
                            category: document.getElementById('project-category').value,
                            description: document.getElementById('project-description').value,
                            technologies: technologies,
                            liveUrl: document.getElementById('project-live').value,
                            githubUrl: document.getElementById('project-github').value,
                            datePosted: new Date().toISOString().split('T')[0]
                        };
                    }
                } else {
                    // Add new project
                    const newProject = {
                        title: projectTitle,
                        category: document.getElementById('project-category').value,
                        description: document.getElementById('project-description').value,
                        technologies: technologies,
                        liveUrl: document.getElementById('project-live').value,
                        githubUrl: document.getElementById('project-github').value,
                        datePosted: new Date().toISOString().split('T')[0],
                        image: response.data ? response.data.image : '/uploads/default-project.jpg'
                    };
                    
                    if (response.data) {
                        adminData.projects.push({ ...newProject, ...response.data });
                    } else {
                        adminData.projects.push(newProject);
                    }
                }
                
                // Reload data from server to ensure sync
                await loadProjectsFromServer();
                
                showToast(projectId ? 'Project updated successfully!' : 'Project added successfully!');
                
                // Reload table and close modal
                loadProjectsTable();
                closeModal(projectModal);
                
                // Update dashboard stats
                updateDashboardStats();
                
                // Trigger real-time update
                broadcastUpdate('projects');
                
            } catch (error) {
                console.error('Error saving project:', error);
                showToast('Error saving project: ' + error.message, 'error');
            }
        });

        // Add Site
        addSiteBtn.addEventListener('click', () => {
            document.getElementById('site-modal-title').textContent = 'Add New Site';
            siteForm.reset();
            document.getElementById('site-id').value = '';
            openModal(siteModal);
        });

        // Site form submission
        siteForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const siteId = document.getElementById('site-id').value;
            const siteName = document.getElementById('site-name').value.trim();
            const siteUrl = document.getElementById('site-url').value.trim();
            const siteDescription = document.getElementById('site-description').value.trim();
            
            if (!siteName || !siteUrl) {
                showToast('Please fill in all required fields!', 'error');
                return;
            }
            
            // Validate URL format
            try {
                new URL(siteUrl);
            } catch (error) {
                showToast('Please enter a valid URL!', 'error');
                return;
            }
            
            const siteData = {
                name: siteName,
                url: siteUrl,
                description: siteDescription
            };
            
            try {
                let response;
                
                if (siteId) {
                    // Update existing site
                    response = await apiCall(`/sites/${siteId}`, {
                        method: 'PUT',
                        body: JSON.stringify(siteData)
                    });
                    
                    // Update local data - find by _id
                    const siteIndex = adminData.sites.findIndex(s => s._id === siteId);
                    if (siteIndex !== -1) {
                        adminData.sites[siteIndex] = { ...adminData.sites[siteIndex], ...siteData };
                    }
                    
                    showToast('Site updated successfully!');
                } else {
                    // Add new site
                    response = await apiCall('/sites', {
                        method: 'POST',
                        body: JSON.stringify(siteData)
                    });
                    
                    // Add to local data
                    if (response && response.data) {
                        adminData.sites.push(response.data);
                    } else {
                        // Fallback if no response data
                        adminData.sites.push({ ...siteData, id: Date.now().toString() });
                    }
                    
                    showToast('Site added successfully!');
                }
                
                // Reload data from server to ensure sync
                await loadSitesFromServer();
                
                loadSitesTable();
                closeModal(siteModal);
                updateDashboardStats();
                
            } catch (error) {
                console.error('Error saving site:', error);
                showToast('Error saving site: ' + error.message, 'error');
            }
        });

        // Add Skill
        addSkillBtn.addEventListener('click', () => {
            document.getElementById('skill-modal-title').textContent = 'Add New Skill';
            skillForm.reset();
            document.getElementById('skill-id').value = '';
            document.getElementById('icon-preview').style.display = 'none';
            openModal(skillModal);
        });

        // Skill form submission
        skillForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const skillId = document.getElementById('skill-id').value;
            const skillName = document.getElementById('skill-name').value.trim();
            const skillIcon = document.getElementById('skill-icon').value.trim();
            const skillDescription = document.getElementById('skill-description').value.trim();
            
            if (!skillName || !skillIcon) {
                showToast('Please fill in all required fields!', 'error');
                return;
            }
            
            const skillData = {
                name: skillName,
                icon: skillIcon,
                description: skillDescription
            };
            
            try {
                let response;
                
                if (skillId) {
                    // Update existing skill
                    response = await apiCall(`/skills/${skillId}`, {
                        method: 'PUT',
                        body: JSON.stringify(skillData)
                    });
                    
                    // Update local data - find by _id
                    const skillIndex = adminData.skills.findIndex(s => s._id === skillId);
                    if (skillIndex !== -1) {
                        adminData.skills[skillIndex] = { ...adminData.skills[skillIndex], ...skillData };
                    }
                    
                    showToast('Skill updated successfully!');
                } else {
                    // Add new skill
                    response = await apiCall('/skills', {
                        method: 'POST',
                        body: JSON.stringify(skillData)
                    });
                    
                    // Add to local data
                    if (response && response.data) {
                        adminData.skills.push(response.data);
                    } else {
                        // Fallback if no response data
                        adminData.skills.push(skillData);
                    }
                    
                    showToast('Skill added successfully!');
                }
                
                // Reload data from server to ensure sync
                await loadSkillsFromServer();
                
                loadSkillsTable();
                closeModal(skillModal);
                updateDashboardStats();
                
            } catch (error) {
                console.error('Error saving skill:', error);
                showToast('Error saving skill: ' + error.message, 'error');
            }
        });

        // Fetch Icon button event listener
        if (fetchIconBtn) {
            fetchIconBtn.addEventListener('click', fetchIconFromAPI);
        }

        // Edit Project
        function editProject(index) {
            const project = adminData.projects[index];
            document.getElementById('project-modal-title').textContent = 'Edit Project';
            document.getElementById('project-id').value = project._id;
            document.getElementById('project-title').value = project.title;
            document.getElementById('project-category').value = project.category;
            document.getElementById('project-description').value = project.description || '';
            document.getElementById('project-live').value = project.liveUrl || '';
            document.getElementById('project-github').value = project.githubUrl || '';
            
            // Handle technologies
            technologies = project.technologies || [];
            renderTechnologies();
            
            // Handle image preview
            const preview = document.getElementById('image-preview');
            if (project.image) {
                preview.innerHTML = `<img src="${project.image}" alt="Project Image">`;
            } else {
                preview.innerHTML = '<div class="image-placeholder">No image selected</div>';
            }
            
            openModal(projectModal);
        }

        // Edit Skill
        function editSkill(index) {
            const skill = adminData.skills[index];
            document.getElementById('skill-modal-title').textContent = 'Edit Skill';
            document.getElementById('skill-id').value = skill._id;
            document.getElementById('skill-name').value = skill.name;
            document.getElementById('skill-icon').value = skill.icon;
            document.getElementById('skill-description').value = skill.description || '';
            
            // Show icon preview for existing skill
            if (skill.icon && skill.name) {
                const preview = document.getElementById('icon-preview');
                const iconDisplay = document.getElementById('icon-display');
                const iconName = document.getElementById('icon-name');
                
                iconDisplay.className = skill.icon;
                iconName.textContent = skill.name;
                preview.style.display = 'flex';
            } else {
                document.getElementById('icon-preview').style.display = 'none';
            }
            
            openModal(skillModal);
        }

        // Edit Site
        function editSite(index) {
            const site = adminData.sites[index];
            document.getElementById('site-modal-title').textContent = 'Edit Site';
            document.getElementById('site-id').value = site._id;
            document.getElementById('site-name').value = site.name;
            document.getElementById('site-url').value = site.url;
            document.getElementById('site-description').value = site.description || '';
            openModal(siteModal);
        }

        // Delete Project
        async function deleteProject(index) {
            showCustomConfirm('Are you sure you want to delete this project?', async () => {
                try {
                    const project = adminData.projects[index];
                    if (project._id) {
                        await apiCall(`/projects/${project._id}`, {
                            method: 'DELETE'
                        });
                    }
                    
                    // Reload data from server to ensure sync
                    await loadProjectsFromServer();
                    
                    loadProjectsTable();
                    updateDashboardStats();
                    showCustomNotification('Project deleted successfully!', 'success');
                    
                    // Trigger real-time update
                    broadcastUpdate('projects');
                } catch (error) {
                    console.error('Error deleting project:', error);
                    showCustomNotification('Error deleting project: ' + error.message, 'error');
                }
            });
        }

        // Delete Skill
        async function deleteSkill(index) {
            showCustomConfirm('Are you sure you want to delete this skill?', async () => {
                try {
                    const skill = adminData.skills[index];
                    if (skill._id) {
                        await apiCall(`/skills/${skill._id}`, {
                            method: 'DELETE'
                        });
                    }
                    
                    // Reload data from server to ensure sync
                    await loadSkillsFromServer();
                    
                    loadSkillsTable();
                    updateDashboardStats();
                    showCustomNotification('Skill deleted successfully!', 'success');
                } catch (error) {
                    console.error('Error deleting skill:', error);
                    showCustomNotification('Error deleting skill: ' + error.message, 'error');
                }
            });
        }

        // Delete Site
        async function deleteSite(index) {
            showCustomConfirm('Are you sure you want to delete this site?', async () => {
                try {
                    const site = adminData.sites[index];
                    if (site._id) {
                        await apiCall(`/sites/${site._id}`, {
                            method: 'DELETE'
                        });
                    }
                    
                    // Reload data from server to ensure sync
                    await loadSitesFromServer();
                    
                    loadSitesTable();
                    updateDashboardStats();
                    showCustomNotification('Site deleted successfully!', 'success');
                } catch (error) {
                    console.error('Error deleting site:', error);
                    showCustomNotification('Error deleting site: ' + error.message, 'error');
                }
            });
        }

        // Initialize the dashboard when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Check authentication first
            if (!checkAuthentication()) {
                return;
            }
            
            // Initialize dashboard if authenticated
            initializeDashboard();
        });
    </script>
</body>
</html>